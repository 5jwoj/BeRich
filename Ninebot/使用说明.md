# 九号出行自动签到脚本 v1.2.0

## ✨ 新版本特性

### v1.2.0 更新内容
- ✅ **支持简化的分隔符格式**：使用 `#` 和 `&` 分隔账号信息，无需 JSON 格式
- ✅ **支持自定义 User-Agent**：每个账号可以设置独立的 UA
- ✅ **向后兼容**：仍然支持 JSON 格式和旧版单账号配置

### v1.1.0 功能
- ✅ 自动签到
- ✅ 自动领取任务奖励
- ✅ 多账号支持
- ✅ 青龙面板集成
- ✅ 请求失败自动重试

---

## 📋 配置格式说明

### 格式 1：分隔符格式（推荐）⭐

**单账号：**
```bash
NINEBOT_ACCOUNTS=deviceId#Authorization#UA
```

**多账号：**
```bash
NINEBOT_ACCOUNTS=deviceId1#Authorization1#UA1&deviceId2#Authorization2#UA2&deviceId3#Authorization3#UA3
```

**说明：**
- 使用 `#` 分隔每个账号的三个字段
- 使用 `&` 分隔不同账号
- `UA`（User-Agent）可选，不需要自定义可以省略

**示例（不带自定义 UA）：**
```bash
NINEBOT_ACCOUNTS=DB63B81C-04CA-4A43-95BE-B20C8C134280#eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...&AB25DF68-72A0-4E0B-B3F5-B4FF07DDBCF9#eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

**示例（带自定义 UA）：**
```bash
NINEBOT_ACCOUNTS=DB63B81C-04CA-4A43-95BE-B20C8C134280#eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...#Mozilla/5.0 (iPhone)&AB25DF68-72A0-4E0B-B3F5-B4FF07DDBCF9#eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...#Mozilla/5.0 (iPad)
```

---

### 格式 2：JSON 格式（兼容旧版本）

```json
[
  {
    "name": "账号1",
    "deviceId": "DB63B81C-04CA-4A43-95BE-B20C8C134280",
    "authorization": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userAgent": "Mozilla/5.0 (iPhone)"
  },
  {
    "name": "账号2",
    "deviceId": "AB25DF68-72A0-4E0B-B3F5-B4FF07DDBCF9",
    "authorization": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
]
```

**注意：** JSON 格式必须使用英文双引号，不能使用中文引号。

---

### 格式 3：单账号独立变量（兼容旧版本）

```bash
NINEBOT_DEVICE_ID=your-device-id-here
NINEBOT_AUTHORIZATION=your-authorization-token-here
NINEBOT_UA=your-custom-user-agent-here
NINEBOT_NAME=我的账号
```

---

## 🚀 使用方法

### 青龙面板

1. **安装依赖**
   - 进入青龙面板 → 依赖管理 → NodeJs
   - 添加依赖：`axios` 和 `moment`

2. **添加脚本**
   - 进入青龙面板 → 脚本管理
   - 上传 `ninebot_daily.js`

3. **配置环境变量**
   - 进入青龙面板 → 环境变量
   - 添加变量 `NINEBOT_ACCOUNTS`
   - 填入您的账号信息（推荐使用格式 1）

4. **添加定时任务**
   - 进入青龙面板 → 定时任务
   - 添加任务：`node ninebot_daily.js`
   - 设置定时：`0 8 * * *`（每天早上 8 点执行）

---

## 📝 获取账号信息

### 方法 1：使用抓包工具

1. 安装抓包工具（如 Charles、Fiddler、HTTP Catcher）
2. 打开九号出行 App
3. 执行签到操作
4. 查找请求到 `cn-cbu-gateway.ninebot.com` 的请求
5. 从请求头中获取：
   - `deviceId`：通常在请求参数或请求体中
   - `Authorization`：在请求头中，通常以 `eyJ` 开头

### 方法 2：使用浏览器开发者工具

1. 打开九号出行 H5 页面
2. 按 F12 打开开发者工具
3. 切换到 Network（网络）标签
4. 执行签到操作
5. 查找相关请求并获取信息

---

## 🔧 故障排查

### 问题 1：提示"未配置任何有效的九号出行账号信息"

**解决方法：**
- 检查环境变量 `NINEBOT_ACCOUNTS` 是否正确设置
- 确认格式是否正确（使用英文符号）
- 查看青龙面板日志，确认具体错误信息

### 问题 2：签到失败

**可能原因：**
- Authorization Token 已过期（需要重新抓包获取）
- deviceId 不正确
- 网络连接问题

**解决方法：**
- 重新抓包获取最新的 Authorization
- 检查 deviceId 是否正确
- 查看脚本日志了解详细错误信息

### 问题 3：JSON 格式解析失败

**常见错误：**
- 使用了中文引号（" "）而不是英文引号（" "）
- 使用了中文逗号（，）而不是英文逗号（,）
- JSON 结构不完整

**解决方法：**
- 使用推荐的分隔符格式（格式 1）
- 或者使用在线 JSON 验证工具检查格式

---

## 📊 执行结果示例

```
================== 共发现 3 个账号 ==================

===== 开始处理账号: 账号1 =====
[账号1] 开始执行签到任务...
[账号1] 尝试独立获取账户金币余额...
[账号1] 成功获取到金币余额: 1250
[账号1] 验证登录状态并获取签到信息...
[账号1] 验证成功，获取到签到信息
[账号1] 开始执行签到 API...
[账号1] 签到 API 调用成功
[账号1] 签到成功，获取最新数据...
[账号1] 开始检查并领取任务奖励...
[账号1] 发现 2 个可领取的任务
[账号1] 成功领取奖励: 每日签到 -> 10金币
[账号1] 成功领取奖励: 分享任务 -> 5金币
[账号1] 任务执行完成

✅ 账号1
  账号名称: 账号1
  当前金币总数: 1265
  连续签到天数: 7天
  今日签到状态: 已签到🎉
  签到结果: 签到成功🎉🎉
  领取奖励: 成功 2 个，失败 0 个
```

---

## 📄 许可证

本脚本仅供学习交流使用，请勿用于商业用途。

---

## 🙏 致谢

感谢所有贡献者和使用者的支持！
