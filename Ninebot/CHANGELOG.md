# 九号出行自动签到脚本 - 更新日志

## v1.2.1 (2025-12-02)

### 🔧 修复与改进

1. **添加自动领取奖励开关**
   - 新增环境变量 `ENABLE_AUTO_REWARD`（默认 `false`）
   - 默认关闭自动领取奖励功能，提高脚本稳定性
   - 用户可以通过设置 `ENABLE_AUTO_REWARD=true` 启用该功能

2. **优化错误处理**
   - 增强任务列表 API 的调试日志
   - 尝试多种请求方式（GET + 参数、POST + body、POST + 空body）
   - 更友好的错误提示信息

3. **诊断结果**
   - 确认任务列表接口 `/portal/self-service/task/list` 需要特定参数
   - 目前已知的问题：
     - GET 请求返回 `Params error`（参数错误）
     - POST 请求返回 `method error`（不支持 POST）
   - 需要进一步抓包分析正确的请求参数

### 📝 使用说明

#### 默认配置（推荐）

```bash
# 只使用签到功能，不启用自动领取奖励
NINEBOT_ACCOUNTS=deviceId1#Authorization1&deviceId2#Authorization2
```

脚本将正常执行签到，并显示：
```
领取奖励: 功能已关闭（可设置 ENABLE_AUTO_REWARD=true 启用）
```

#### 启用自动领取奖励（实验性）

```bash
# 启用自动领取奖励功能
ENABLE_AUTO_REWARD=true
NINEBOT_ACCOUNTS=deviceId1#Authorization1&deviceId2#Authorization2
```

**注意**：目前该功能可能无法正常工作，会显示"获取任务列表失败"。

### 🔍 如何修复自动领取奖励功能

如果您想帮助修复该功能，请按以下步骤操作：

1. **安装抓包工具**
   - iOS：HTTP Catcher、Stream
   - Android：HttpCanary、Packet Capture
   - 电脑：Charles、Fiddler

2. **抓取请求**
   - 打开九号出行 App
   - 进入"任务中心"或"我的任务"页面
   - 查看任务列表

3. **查找关键信息**
   - 找到请求 URL：`/portal/self-service/task/list`
   - 记录请求方法（GET/POST）
   - 记录所有查询参数（如 `?type=xxx&status=xxx`）
   - 记录请求头中的特殊字段

4. **提供信息**
   - 将完整的请求信息反馈给开发者
   - 我们将根据实际请求更新脚本

### ✅ 当前功能状态

| 功能 | 状态 | 说明 |
|------|------|------|
| 自动签到 | ✅ 正常 | 完美运行，支持多账号 |
| 获取金币余额 | ✅ 正常 | 可以正确获取账户金币数 |
| 连续签到天数 | ✅ 正常 | 正确显示连续签到天数 |
| 自动领取奖励 | ⚠️ 实验性 | API 参数不明确，默认关闭 |
| 多账号支持 | ✅ 正常 | 支持分隔符和 JSON 格式 |
| 青龙面板集成 | ✅ 正常 | 完美集成，支持通知推送 |

### 📊 执行结果示例

```
🛴 九号出行签到结果

✅ z.W.
  账号名称: z.W.
  当前金币总数: 1649
  连续签到天数: 432天
  今日签到状态: 已签到🎉
  签到结果: 今日已签到，跳过
  领取奖励: 功能已关闭（可设置 ENABLE_AUTO_REWARD=true 启用）

✅ 老年情怀
  账号名称: 老年情怀
  当前金币总数: 20
  连续签到天数: 40天
  今日签到状态: 已签到🎉
  签到结果: 今日已签到，跳过
  领取奖励: 功能已关闭（可设置 ENABLE_AUTO_REWARD=true 启用）
```

---

## v1.2.0 (2025-12-02)

### ✨ 新功能

1. **支持简化的分隔符格式**
   - 使用 `#` 和 `&` 分隔账号信息
   - 无需复杂的 JSON 格式
   - 格式：`deviceId1#Authorization1#UA1&deviceId2#Authorization2#UA2`

2. **支持自定义 User-Agent**
   - 每个账号可以设置独立的 UA
   - UA 参数可选，不设置则使用默认值

3. **向后兼容**
   - 仍然支持 JSON 格式配置
   - 仍然支持旧版单账号配置

---

## v1.1.0 (2025-12-01)

### ✨ 新功能

1. **自动领取任务奖励**
   - 自动检测可领取的任务
   - 自动领取奖励
   - 显示领取结果统计

2. **多账号支持**
   - 支持配置多个账号
   - 并发执行签到任务

3. **青龙面板集成**
   - 支持青龙通知推送
   - 自动读取环境变量

---

## 反馈与建议

如有问题或建议，欢迎反馈！
